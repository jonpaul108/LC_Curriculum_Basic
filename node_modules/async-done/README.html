<p>&lt;p align=&quot;center&quot;&gt;
&lt;a href=&quot;http://gulpjs.com&quot;&gt;
&lt;img height=&quot;257&quot; width=&quot;114&quot; src=&quot;https://raw.githubusercontent.com/gulpjs/artwork/master/gulp-2x.png&quot;&gt;
&lt;/a&gt;
&lt;/p&gt;</p>
<h1>async-done</h1>
<p><a href="https://www.npmjs.com/package/async-done"><img src="https://img.shields.io/npm/v/async-done.svg" alt="NPM version"></a> <a href="https://www.npmjs.com/package/async-done"><img src="https://img.shields.io/npm/dm/async-done.svg" alt="Downloads"></a> <a href="https://dev.azure.com/gulpjs/gulp/_build/latest?definitionId=6&amp;branchName=master"><img src="https://dev.azure.com/gulpjs/gulp/_apis/build/status/async-done?branchName=master" alt="Azure Pipelines Build Status"></a> <a href="https://travis-ci.org/gulpjs/async-done"><img src="https://img.shields.io/travis/gulpjs/async-done.svg?label=travis-ci" alt="Travis Build Status"></a> <a href="https://ci.appveyor.com/project/gulpjs/async-done"><img src="https://img.shields.io/appveyor/ci/gulpjs/async-done.svg?label=appveyor" alt="AppVeyor Build Status"></a> <a href="https://coveralls.io/r/gulpjs/async-done"><img src="https://img.shields.io/coveralls/gulpjs/async-done/master.svg" alt="Coveralls Status"></a> <a href="https://gitter.im/gulpjs/gulp"><img src="https://badges.gitter.im/gulpjs/gulp.svg" alt="Gitter chat"></a></p>
<p>Allows libraries to handle various caller provided asynchronous functions uniformly. Maps promises, observables, child processes and streams, and callbacks to callback style.</p>
<p>As async conventions evolve, it is useful to be able to deal with several different <em>styles</em> of async completion uniformly. With this module you can handle completion using a node-style callback, regardless of a return value that's a promise, observable, child process or stream.</p>
<h2>Usage</h2>
<h3>Successful completion</h3>
<pre><code class="language-js">var asyncDone = require('async-done');

asyncDone(function(done){
  // do async things
  done(null, 2);
}, function(error, result){
  // `error` will be null on successful execution of the first function.
  // `result` will be the result from the first function.
});
</code></pre>
<h3>Failed completion</h3>
<pre><code class="language-js">var asyncDone = require('async-done');

asyncDone(function(done){
  // do async things
  done(new Error('Some Error Occurred'));
}, function(error, result){
  // `error` will be an error from the first function.
  // `result` will be undefined on failed execution of the first function.
});
</code></pre>
<h2>API</h2>
<h3><code>asyncDone(fn, callback)</code></h3>
<p>Takes a function to execute (<code>fn</code>) and a function to call on completion (<code>callback</code>).</p>
<h4><code>fn([done])</code></h4>
<p>Optionally takes a callback to call when async tasks are complete.</p>
<h4>Completion and Error Resolution</h4>
<ul>
<li><code>Callback</code> (<code>done</code>) called
<ul>
<li>Completion: called with null error</li>
<li>Error: called with non-null error</li>
</ul>
</li>
<li><code>Stream</code> or <code>EventEmitter</code> returned
<ul>
<li>Completion: <a href="https://www.npmjs.com/package/end-of-stream">end-of-stream</a> module</li>
<li>Error: <a href="http://nodejs.org/api/domain.html">domains</a></li>
<li><strong>Note:</strong> Only actual streams are supported, not faux-streams; Therefore, modules like <a href="https://github.com/dominictarr/event-stream"><code>event-stream</code></a> are not supported.</li>
</ul>
</li>
<li><code>Child Process</code> returned
<ul>
<li>Completion <a href="https://www.npmjs.com/package/end-of-stream">end-of-stream</a> module</li>
<li>Error: <a href="http://nodejs.org/api/domain.html">domains</a></li>
</ul>
</li>
<li><code>Promise</code> returned
<ul>
<li>Completion: <a href="http://promisesaplus.com/#point-26">onFulfilled</a> method called</li>
<li>Error: <a href="http://promisesaplus.com/#point-30">onRejected</a> method called</li>
</ul>
</li>
<li><code>Observable</code> (e.g. from <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html">RxJS v5</a> or <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html">RxJS v4</a>) returned
<ul>
<li>Completion: <a href="http://reactivex.io/rxjs/class/es6/MiscJSDoc.js~ObserverDoc.html#instance-method-complete">complete</a> method called</li>
<li>Error: <a href="http://reactivex.io/rxjs/class/es6/MiscJSDoc.js~ObserverDoc.html#instance-method-error">error</a> method called</li>
</ul>
</li>
</ul>
<p><strong>Warning:</strong> Sync tasks are <strong>not supported</strong> and your function will never complete if the one of the above strategies is not used to signal completion. However, thrown errors will be caught by the domain.</p>
<h4><code>callback(error, result)</code></h4>
<p>If an error doesn't occur in the execution of the <code>fn</code> function, the <code>callback</code> method will receive the results as its second argument. Note: Some streams don't received any results.</p>
<p>If an error occurred in the execution of the <code>fn</code> function, The <code>callback</code> method will receive an error as its first argument.</p>
<p>Errors can be caused by:</p>
<ul>
<li>A thrown error</li>
<li>An error passed to a <code>done</code> callback</li>
<li>An <code>error</code> event emitted on a returned <code>Stream</code>, <code>EventEmitter</code> or <code>Child Process</code></li>
<li>A rejection of a returned <code>Promise</code> - If the <code>Promise</code> is not rejected with a value, we generate a new <code>Error</code></li>
<li>The <code>onError</code> handler being called on an <code>Observable</code></li>
</ul>
<h2>License</h2>
<p>MIT</p>
